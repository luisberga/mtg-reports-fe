<div class="card-history-container">
  <div class="header">
    <div class="header-left">
      <h1>üìà Card Price History</h1>
      <p class="subtitle">Track price changes over time</p>
    </div>
    <div class="header-actions">
      <a routerLink="/cards" class="btn btn-secondary">
        ‚Üê Back to Cards
      </a>
    </div>
  </div>

  <!-- Items per page selector -->
  <div class="controls" *ngIf="!isLoading && totalItems > 0">
    <div class="items-per-page">
      <label for="itemsPerPage">Records per page:</label>
      <select id="itemsPerPage" [value]="itemsPerPage" (change)="onItemsPerPageChange($event)">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option value="50">50</option>
      </select>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Loading price history...</p>
  </div>

  <div *ngIf="!isLoading && historyCards.length === 0" class="empty-state">
    <div class="empty-icon">üìä</div>
    <h3>No Price History Available</h3>
    <p>No historical price data found for this card.</p>
    <div class="empty-actions">
      <a routerLink="/cards" class="btn btn-primary">Back to Cards</a>
    </div>
  </div>

  <div *ngIf="!isLoading && historyCards.length > 0" class="history-section">
    <div class="history-stats" *ngIf="historyCards.length > 0">
      <div class="stat-card">
        <div class="stat-icon">üìä</div>
        <div class="stat-content">
          <div class="stat-value">{{ totalItems }}</div>
          <div class="stat-label">Price Records</div>
        </div>
      </div>
      
      <div class="stat-card" *ngIf="historyCards[0]">
        <div class="stat-icon">üí∞</div>
        <div class="stat-content">
          <div class="stat-value">${{ historyCards[0].last_price.toFixed(2) }}</div>
          <div class="stat-label">Current Price</div>
        </div>
      </div>
    </div>

    <div class="history-table">
      <table>
        <thead>
          <tr>
            <th>Card Name</th>
            <th>Set</th>
            <th>Type</th>
            <th>Price</th>
            <th>Change</th>
            <th>Last Updated</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let card of historyCards; trackBy: trackByCardId" class="history-row" 
              [class.price-up]="card.price_change > 0" 
              [class.price-down]="card.price_change < 0">
            <td class="card-name">
              <div class="card-name-container">
                <span class="name">{{ card.name }}</span>
                <small class="collector-number">#{{ card.collector_number }}</small>
              </div>
            </td>
            <td class="card-set">
              <span class="set-badge">{{ card.set.toUpperCase() }}</span>
            </td>
            <td class="card-foil">
              <span *ngIf="card.foil" class="foil-badge">‚ú® Foil</span>
              <span *ngIf="!card.foil" class="regular-badge">‚ö™ Regular</span>
            </td>
            <td class="card-price">
              <div class="price-container">
                <span class="current-price">${{ card.last_price.toFixed(2) }}</span>
                <small class="old-price" *ngIf="card.old_price !== card.last_price">
                  was ${{ card.old_price.toFixed(2) }}
                </small>
              </div>
            </td>
            <td class="price-change">
              <span class="change-indicator" *ngIf="card.price_change !== 0">
                <span *ngIf="card.price_change > 0" class="positive">
                  üìà +${{ card.price_change.toFixed(2) }}
                </span>
                <span *ngIf="card.price_change < 0" class="negative">
                  üìâ ${{ card.price_change.toFixed(2) }}
                </span>
              </span>
              <span *ngIf="card.price_change === 0" class="neutral">‚Äî</span>
            </td>
            <td class="last-update">
              {{ getRelativeTime(card.last_update) }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <div class="pagination-info">
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} - {{ Math.min(currentPage * itemsPerPage, totalItems) }} of {{ totalItems }} records
      </div>
      
      <div class="pagination">
        <button class="pagination-btn" (click)="prevPage()" [disabled]="currentPage === 1" title="Previous page">
          ‚Üê Previous
        </button>
        
        <button 
          *ngFor="let page of getPageNumbers()" 
          class="pagination-btn" 
          [class.active]="page === currentPage"
          (click)="goToPage(page)">
          {{ page }}
        </button>
        
        <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage === totalPages" title="Next page">
          Next ‚Üí
        </button>
      </div>
    </div>
  </div>
</div> 