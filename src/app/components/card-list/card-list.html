<div class="card-list-container">
  <div class="header-section">
    <h2>üÉè Minhas Cartas MTG</h2>
    <p>Gerencie sua cole√ß√£o de cartas Magic The Gathering</p>
  </div>

  <!-- Filtros e Busca -->
  <div class="filters-section card">
    <h3>üîç Filtros de Busca</h3>
    
    <div class="filters-grid">
      <div class="form-group">
        <label for="searchName">Nome da Carta</label>
        <input 
          type="text" 
          id="searchName"
          [ngModel]="searchName()"
          (ngModelChange)="searchName.set($event); onSearchChange()"
          placeholder="Digite o nome da carta..."
        />
      </div>
      
      <div class="form-group">
        <label for="searchSet">Conjunto (Set)</label>
        <input 
          type="text" 
          id="searchSet"
          [ngModel]="searchSet()"
          (ngModelChange)="searchSet.set($event); onSearchChange()"
          placeholder="Digite o nome do conjunto..."
        />
      </div>
      
      <div class="form-group">
        <label for="searchCollectorNumber">N√∫mero do Colecionador</label>
        <input 
          type="text" 
          id="searchCollectorNumber"
          [ngModel]="searchCollectorNumber()"
          (ngModelChange)="searchCollectorNumber.set($event); onSearchChange()"
          placeholder="Digite o n√∫mero..."
        />
      </div>
    </div>
    
    <div class="actions">
      <button 
        class="btn btn-secondary"
        (click)="loadCards()"
        [disabled]="loading()"
      >
        üîÑ Atualizar Lista
      </button>
      
      <a routerLink="/cards/new" class="btn btn-primary">
        ‚ûï Nova Carta
      </a>
    </div>
  </div>

  <!-- Estados de Loading e Error -->
  @if (loading()) {
    <div class="loading">
      Carregando cartas...
    </div>
  }

  @if (error()) {
    <div class="alert alert-danger">
      {{ error() }}
      <button class="btn btn-secondary" (click)="loadCards()">
        Tentar Novamente
      </button>
    </div>
  }

  <!-- Lista de Cartas -->
  @if (!loading() && !error()) {
    <div class="results-section">
      <div class="results-header">
        <h3>üìä Resultados</h3>
        <span class="count">
          {{ filteredCards().length }} carta(s) encontrada(s)
        </span>
      </div>

      @if (filteredCards().length === 0) {
        <div class="empty-state card">
          <h4>üòÖ Nenhuma carta encontrada</h4>
          <p>Tente ajustar os filtros de busca ou adicione novas cartas √† sua cole√ß√£o.</p>
          <a routerLink="/cards/new" class="btn btn-primary">
            ‚ûï Adicionar Primeira Carta
          </a>
        </div>
      } @else {
        <!-- Tabela Responsiva -->
        <div class="table-container">
          <table class="cards-table">
            <thead>
              <tr>
                <th>
                  <button 
                    class="sort-btn"
                    (click)="onSortChange('name')"
                    [class.active]="sortBy() === 'name'"
                  >
                    Nome
                    @if (sortBy() === 'name') {
                      <span class="sort-icon">
                        {{ sortDirection() === 'asc' ? '‚Üë' : '‚Üì' }}
                      </span>
                    }
                  </button>
                </th>
                <th>
                  <button 
                    class="sort-btn"
                    (click)="onSortChange('set')"
                    [class.active]="sortBy() === 'set'"
                  >
                    Conjunto
                    @if (sortBy() === 'set') {
                      <span class="sort-icon">
                        {{ sortDirection() === 'asc' ? '‚Üë' : '‚Üì' }}
                      </span>
                    }
                  </button>
                </th>
                <th>N√∫mero</th>
                <th>Foil</th>
                <th>
                  <button 
                    class="sort-btn"
                    (click)="onSortChange('price')"
                    [class.active]="sortBy() === 'price'"
                  >
                    Pre√ßo Atual
                    @if (sortBy() === 'price') {
                      <span class="sort-icon">
                        {{ sortDirection() === 'asc' ? '‚Üë' : '‚Üì' }}
                      </span>
                    }
                  </button>
                </th>
                <th>Varia√ß√£o</th>
                <th>
                  <button 
                    class="sort-btn"
                    (click)="onSortChange('date')"
                    [class.active]="sortBy() === 'date'"
                  >
                    √öltima Atualiza√ß√£o
                    @if (sortBy() === 'date') {
                      <span class="sort-icon">
                        {{ sortDirection() === 'asc' ? '‚Üë' : '‚Üì' }}
                      </span>
                    }
                  </button>
                </th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              @for (card of filteredCards(); track card.id) {
                <tr class="card-row">
                  <td class="card-name">
                    <strong>{{ card.name }}</strong>
                  </td>
                  <td class="card-set">
                    <span class="set-badge">{{ card.set.toUpperCase() }}</span>
                  </td>
                  <td class="card-number">{{ card.collector_number }}</td>
                  <td class="card-foil">
                    @if (card.foil) {
                      <span class="foil-badge">‚ú® Foil</span>
                    } @else {
                      <span class="normal-badge">Normal</span>
                    }
                  </td>
                  <td class="card-price">
                    @if (card.last_price) {
                      <strong>{{ formatCurrency(card.last_price) }}</strong>
                    } @else {
                      <span class="no-price">Sem pre√ßo</span>
                    }
                  </td>
                  <td class="card-change">
                    @if (card.price_change !== 0) {
                      <span [class]="'price-change ' + getPriceChangeClass(card.price_change)">
                        {{ getPriceChangeIcon(card.price_change) }}
                        {{ formatCurrency(abs(card.price_change)) }}
                      </span>
                    } @else {
                      <span class="no-change">-</span>
                    }
                  </td>
                  <td class="card-date">
                    {{ formatDate(card.last_update) }}
                  </td>
                  <td class="card-actions">
                    <div class="action-buttons">
                      <button 
                        class="btn btn-sm btn-secondary"
                        [routerLink]="['/cards', card.id]"
                        title="Ver detalhes"
                      >
                        üëÅÔ∏è
                      </button>
                      <button 
                        class="btn btn-sm btn-primary"
                        [routerLink]="['/cards', card.id, 'edit']"
                        title="Editar"
                      >
                        ‚úèÔ∏è
                      </button>
                      <button 
                        class="btn btn-sm btn-danger"
                        (click)="deleteCard(card.id)"
                        title="Excluir"
                      >
                        üóëÔ∏è
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>
  }
